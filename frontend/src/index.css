/* Tailwind (laisse ces 3 lignes tout en haut si tu utilises Tailwind) */
@tailwind base;
@tailwind components;
@tailwind utilities;

/* Theme variables (default to Tailwind blue) */
:root {
  /* Primary brand (personalizable in settings) */
  --brand-600: rgb(37 99 235); /* #2563eb */
  --brand-700: rgb(29 78 216); /* #1d4ed8 */

  /* Derived tokens */
  --brand-50: color-mix(in srgb, var(--brand-600) 10%, white);
  --brand-100: color-mix(in srgb, var(--brand-600) 18%, white);
  --brand-200: color-mix(in srgb, var(--brand-600) 28%, white);
  --brand-800: color-mix(in srgb, var(--brand-700) 90%, black);

  /* Secondary brand (new) */
  --brand2-600: rgb(13 148 136); /* #0d9488 teal-600 */
  --brand2-700: rgb(15 118 110); /* #0f766e teal-700 */
  --brand2-50: color-mix(in srgb, var(--brand2-600) 10%, white);
  --brand2-100: color-mix(in srgb, var(--brand2-600) 18%, white);

  /* Sidebar / surfaces */
  --sidebar-bg: var(--brand-600);
  --sidebar-bg-hover: var(--brand-700);
  --primary-bg: var(--brand-600);
  --primary-bg-hover: var(--brand-700);

  /* Links */
  --link-blue: #1d4ed8; /* blue-600 */

  --surface-color: rgba(255, 255, 255, 0.92);
  --surface-border: rgba(15, 23, 42, 0.08);
  --surface-shadow: 0 25px 60px -30px rgba(15, 23, 42, 0.35);
  --sidebar-gradient-start: color-mix(in srgb, var(--brand-700) 90%, #0b1220);
  --sidebar-gradient-end: color-mix(in srgb, var(--brand-600) 65%, #0b1220);
  --shell-background: radial-gradient(circle at 15% 20%, rgba(37, 99, 235, 0.16), transparent 45%),
    radial-gradient(circle at 85% 10%, rgba(13, 148, 136, 0.18), transparent 40%),
    #eef2ff;
  --text-primary: #0f172a;
  --text-muted: #64748b;
  /* Sidebar sizing */
  --sidebar-width: 9.5rem; /* default 5.25rem -> widened */
}

/* Map common Tailwind utility classes to brand variables (best effort) */
.bg-blue-600,
.bg-indigo-600 {
  background-color: var(--primary-bg) !important;
}
.hover\:bg-blue-700:hover,
.hover\:bg-indigo-700:hover {
  background-color: var(--primary-bg-hover) !important;
}
.text-blue-600,
.text-indigo-600 {
  color: var(--brand-600) !important;
}
.hover\:text-blue-700:hover,
.hover\:text-indigo-700:hover {
  color: var(--brand-700) !important;
}
.ring-indigo-400 {
  --tw-ring-color: color-mix(in srgb, var(--brand-600) 70%, white);
}

/* ---------- App base ---------- */
html,
body,
#root {
  height: 100%;
  min-height: 100%;
  /* Use modern viewport units so the app fits the browser UI chrome exactly */
  min-height: 100vh;   /* fallback */
  min-height: 100svh;  /* small viewport (mobile address bar shown) */
  min-height: 100dvh;  /* dynamic viewport (preferred) */
}
:root {
  color-scheme: light;
}

/* DB-only sidebar guard: if the backend returns no sidebar items,
   main.jsx sets data-has-sidebar="0" on <html>. Hide sidebar/topbar. */
:root[data-has-sidebar="0"] .app-sidebar { display: none !important; }
/* When DB has no sidebar items, keep topbar visible. Only hide flyout UI. */
:root[data-has-sidebar="0"] .app-sidebar__overlay { display: none !important; }
:root[data-has-sidebar="0"] .app-sidebar__flyout { display: none !important; }
:root[data-has-sidebar="0"] .app-sidebar__flyout-overlay { display: none !important; }

html,
body,
#root {
  background: var(--shell-background);
  color: var(--text-primary);
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

/* Chat palette */
:root {
  /* Softer agent bubble for readability across any brand color */
  --bubble-agent-bg: color-mix(in srgb, var(--brand-600) 12%, white);
  --bubble-agent-bg-hover: color-mix(in srgb, var(--brand-700) 14%, white);
  --bubble-agent-link: var(--link-blue);
  --bubble-visitor-bg: #f3f4f6; /* gray-100 */
  --bubble-visitor-text: #111827; /* gray-900 */
  --bubble-visitor-link: var(--link-blue);
  --ts-muted: #9ca3af; /* gray-400 */
}

/* Liens généraux */
a,
a:link {
  color: #1d4ed8;
}
a:visited {
  color: #7c3aed;
}
a:hover {
  color: #1e40af;
}

/* Inputs visibles */
input,
textarea,
select,
button {
  color: #111827;
}

/* ---------- Emoji flags (Chrome desktop safe) ---------- */
.flag-emoji {
  font-family: "Apple Color Emoji", "Segoe UI Emoji", "Noto Color Emoji",
    "Noto Emoji", "Twemoji Mozilla", "EmojiOne Color", "Android Emoji",
    system-ui, sans-serif !important;
  font-variant-emoji: emoji;
  line-height: 1;
}
img.emoji,
.twemoji {
  height: 1em;
  width: 1em;
  margin: 0 0.05em;
  vertical-align: -0.1em;
}

/* ---------- Helpers ---------- */
.text-force {
  color: #111827 !important;
}
.break-anywhere {
  overflow-wrap: anywhere;
  word-break: break-word;
}
#app,
#app * {
  color: inherit;
}
#app {
  color: #111827;
}
.truncate-2 {
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  overflow: hidden;
}

/* Sélection & scrollbars */
::selection {
  background: #dbeafe;
  color: #111827;
}
::-webkit-scrollbar {
  height: 10px;
  width: 10px;
}
::-webkit-scrollbar-thumb {
  background: #cbd5e1;
  border-radius: 8px;
}
::-webkit-scrollbar-thumb:hover {
  background: #94a3b8;
}

/* Petits boutons utilitaires */
.btn {
  background: var(--primary-bg);
  color: #fff;
  border-radius: 0.75rem;
  padding: 0.4rem 0.75rem;
}
.btn:hover {
  background: var(--primary-bg-hover);
}
.btn-secondary {
  background: var(--brand2-600);
  color: #fff;
  border-radius: 0.75rem;
  padding: 0.35rem 0.7rem;
}
.btn-secondary:hover {
  background: var(--brand2-700);
}
.btn-s {
  @apply text-xs px-2 py-1 rounded border bg-white hover:bg-gray-50;
}

/* Zone de conversation : scrollbar toujours visible/stable */
.scroll-area {
  scrollbar-gutter: stable both-edges; /* keep space reserved so layout doesn't jump */
  scrollbar-width: thin; /* Firefox */
  scrollbar-color: #94a3b8 transparent; /* Firefox */
}
.scroll-area::-webkit-scrollbar {
  width: 10px;
}
.scroll-area::-webkit-scrollbar-thumb {
  background: #cbd5e1;
  border-radius: 8px;
}
.scroll-area:hover::-webkit-scrollbar-thumb {
  background: #94a3b8;
}
.scroll-area::-webkit-scrollbar-track {
  background: transparent;
}

/* TipTap */
.ProseMirror {
  min-height: 72px;
  outline: none;
}

/* === BULLES (console opérateur) === */
.chat-bubble {
  max-width: 75%;
  border-radius: 1.1rem; /* gros arrondi pill */
  padding: 0.5rem 0.7rem;
  font-size: 0.875rem; /* 14px */
  line-height: 1.35;
  box-shadow: 0 1px 2px rgba(0, 0, 0, 0.04);
}

.chat-bubble.agent {
  background: var(--brand-600);
  color: #ffffff;
  border: 0;
}
.chat-bubble.agent:hover {
  background: var(--brand-700);
}
.chat-bubble.agent .chat-html {
  line-height: 1.5;
  text-align: left;
}
.chat-bubble.agent .chat-html a {
  color: var(--bubble-agent-link);
  text-decoration: underline;
}
.chat-html a {
  color: var(--link-blue);
  text-decoration: underline;
}
.chat-html a {
  pointer-events: auto;
  cursor: pointer !important;
}

.chat-bubble.visitor {
  background: #eef1f5;
  color: var(--bubble-visitor-text);
  border: 1px solid #e5e7eb;
}

/* Liens dans le HTML rendu des bulles */
.chat-html a,
.draft-html a {
  text-decoration: underline;
}
.chat-bubble.agent .chat-html a,
.prose-invert.chat-html a {
  color: #eaf2ff;
}
.chat-bubble.visitor .chat-html a {
  color: var(--bubble-visitor-link);
}

.chat-bubble.visitor .chat-html {
  text-align: left;
}

/* Timestamp léger si tu l'affiches */
.msg-ts {
  color: var(--ts-muted);
  font-size: 0.75rem;
}

/* Draft preview */
.draft-html {
}

.msg-ts {
  margin-top: 2px;
  font-size: 11px;
  color: #9ca3af; /* gray-400 */
}
/* Chat message layout */
.chat-row {
  max-width: 95%; /* allow bubbles to extend much further */
  display: flex;
  flex-direction: column;
}
.chat-row.mine { align-items: flex-end; }
.chat-row.theirs { align-items: flex-start; }
@media (min-width: 1280px) {
  .chat-row {
    max-width: 88%;
  }
}

/* Bubbles */
.chat-bubble {
  display: inline-block;
  padding: 8px 12px; /* tighter padding */
  border-radius: 14px;
  line-height: 1.4;
  min-width: 120px; /* keep small msgs tidy but not huge */
  max-width: 100%; /* use available chat-row width */
  word-break: break-word;
  overflow-wrap: anywhere;
  box-shadow: 0 1px 2px rgba(0, 0, 0, 0.06);
}

/* uniform rounded bubbles */
.chat-bubble.visitor,
.chat-bubble.agent { border-radius: 20px; }

/* Conversation list badges/highlights using secondary */
.badge-secondary {
  background: var(--brand2-50);
  color: var(--brand2-700);
  border: 1px solid var(--brand2-100);
  border-radius: 9999px;
  padding: 2px 8px;
  font-size: 11px;
}
.row-selected {
  background: var(--brand-50);
}

/* Sidebar overrides with tokens */
.bg-blue-600.sidebar,
.bg-indigo-600.sidebar {
  background-color: var(--sidebar-bg) !important;
}
.sidebar .hover\:bg-blue-700:hover,
.sidebar .hover\:bg-indigo-700:hover {
  background-color: var(--sidebar-bg-hover) !important;
}

/* Ensure paragraphs in bubbles don't add big gaps */
.chat-bubble p {
  margin: 0 0 0.35rem;
}
.chat-bubble p:last-child {
  margin-bottom: 0;
}

/* Timestamp under each bubble */
.msg-ts {
  margin-top: 4px;
  font-size: 11px;
  color: #9ca3af; /* gray-400 */
}
/* ---------- Layout shell refresh ---------- */
.app-shell {
  display: flex;
  min-height: 100vh;
  width: 100%;
  background: transparent;
  color: var(--text-primary);
}
.app-shell__main {
  flex: 1;
  min-height: 0;
  display: flex;
  flex-direction: column;
  gap: 1rem;
  padding: clamp(1rem, 1vw + 0.6rem, 1.8rem);
}
.app-shell__main--tight { padding-top: 0.9rem; padding-bottom: 0.1rem; }
.app-shell__body--tight { gap: 0.75rem; }
.app-shell__body {
  flex: 1;
  min-height: 0;
  display: flex;
  flex-direction: column;
  gap: 1rem;
}
.app-topbar {
  display: flex;
  flex-direction: column;
  gap: 0.9rem;
  background: var(--surface-color);
  border: 1px solid var(--surface-border);
  border-radius: 1.5rem;
  padding: 1.1rem;
  box-shadow: var(--surface-shadow);
  backdrop-filter: blur(12px);
}
/* Compact variant for views that need extra vertical space */
.app-topbar--compact {
  gap: 0.3rem;
  padding: 0.5rem 0.8rem;
  flex-direction: row;
  align-items: center;
  justify-content: space-between;
}
/* Compact typography + spacing tweaks */
.app-topbar--compact .app-topbar__eyebrow { font-size: 0.75rem; }
.app-topbar--compact .app-topbar__title { font-size: clamp(1.1rem, 1vw + 0.8rem, 1.4rem); }
.app-topbar--compact .app-topbar__intro { font-size: 0.85rem; }
.app-topbar--compact .app-topbar__aside { gap: 0.6rem; }
@media (min-width: 1024px) {
  .app-topbar {
    flex-direction: row;
    align-items: center;
    justify-content: space-between;
  }
}
.app-topbar__copy {
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
  max-width: 32rem;
}
.app-topbar__eyebrow {
  font-size: 0.85rem;
  font-weight: 600;
  color: var(--text-muted);
  text-transform: uppercase;
  letter-spacing: 0.08em;
}
.app-topbar__title {
  font-size: clamp(1.25rem, 1vw + 0.9rem, 1.6rem);
  font-weight: 700;
}
.app-topbar__intro {
  font-size: 0.95rem;
  color: var(--text-muted);
}
.app-topbar__aside {
  display: flex;
  flex-wrap: wrap;
  align-items: center;
  gap: 1rem;
  justify-content: flex-start;
}
.status-pill {
  display: inline-flex;
  align-items: center;
  gap: 0.4rem;
  padding: 0.4rem 0.8rem;
  border-radius: 9999px;
  font-size: 0.8rem;
  font-weight: 600;
  background: rgba(15, 23, 42, 0.08);
  color: var(--text-muted);
}
.status-pill--online {
  background: rgba(59, 130, 246, 0.16);
  color: var(--brand-700);
}
.status-pill--offline {
  background: rgba(148, 163, 184, 0.24);
}
.app-metric-list {
  display: flex;
  flex-wrap: wrap;
  gap: 0.9rem;
}
.app-metric {
  min-width: 8rem;
  padding: 0.85rem 1.1rem;
  border-radius: 1.25rem;
  background: rgba(255, 255, 255, 0.9);
  border: 1px solid rgba(148, 163, 184, 0.35);
  box-shadow: 0 12px 24px -22px rgba(15, 23, 42, 0.6);
  display: flex;
  flex-direction: column;
  gap: 0.3rem;
}
.app-metric__value {
  font-size: 1.4rem;
  font-weight: 700;
  color: var(--brand-700);
}
.app-metric__label {
  font-size: 0.8rem;
  color: var(--text-muted);
  font-weight: 500;
}
.panel {
  background: var(--surface-color);
  border: 1px solid var(--surface-border);
  border-radius: 1.5rem;
  box-shadow: var(--surface-shadow);
  display: flex;
  flex-direction: column;
  min-height: 0;
  overflow: hidden;
  backdrop-filter: blur(10px);
}
.panel__header {
  padding: 0.8rem 1rem;
  font-weight: 600;
  border-bottom: 1px solid var(--surface-border);
}
.panel__body {
  flex: 1;
  min-height: 0;
  padding: 0.9rem;
  display: flex;
  flex-direction: column;
  gap: 0.75rem;
}
.panel__body.company-chat-body { padding-bottom: 0.2rem; flex: 0 0 auto; }
.panel__body--scroll {
  overflow-y: auto;
}
.panel__body--flush {
  padding: 0;
}

/* Performance overrides for Grabbing‑Jerome page (toggle via .grabbing-jerome--perf) */
.grabbing-jerome--perf .panel,
.grabbing-jerome--perf .app-topbar {
  -webkit-backdrop-filter: none !important;
  backdrop-filter: none !important;
  box-shadow: 0 1px 2px rgba(0, 0, 0, 0.06) !important;
}

/* Performance overrides for Grabbing‑Sensorex page (toggle via .grabbing-sensorex--perf) */
.grabbing-sensorex--perf .panel,
.grabbing-sensorex--perf .app-topbar {
  -webkit-backdrop-filter: none !important;
  backdrop-filter: none !important;
  box-shadow: 0 1px 2px rgba(0, 0, 0, 0.06) !important;
}

/* Performance overrides for Module Manager (disable expensive backdrops on this view) */
.app-shell.perf-no-backdrop .panel,
.app-shell.perf-no-backdrop .app-topbar {
  -webkit-backdrop-filter: none !important;
  backdrop-filter: none !important;
  box-shadow: 0 1px 2px rgba(0, 0, 0, 0.06) !important;
}

/* ---- Simple SQL pretty view ---- */
.sql-code {
  background: #0b1220; /* dark slate */
  color: #e5e7eb;      /* gray-200 */
  border: 1px solid rgba(148, 163, 184, 0.35);
  border-radius: 0.75rem;
  padding: 0.9rem 1rem;
  font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
  font-size: 12.5px;
  line-height: 1.55;
  max-height: 60vh;
  overflow: auto;
  white-space: pre;
}
.sql-code.sql-code--wrap { white-space: pre-wrap; word-break: break-word; overflow-wrap: anywhere; }
.sql-kw { color: #93c5fd; font-weight: 700; }       /* blue-300 */
.sql-str { color: #86efac; }                        /* green-300 */
.sql-ident { color: #facc15; }                      /* yellow-400 */
.sql-num { color: #fda4af; }                        /* rose-300 */
.sql-op { color: #cbd5e1; }                         /* slate-300 */
.sql-toolbar button { color: #0f172a; }
.sql-editor {
  width: 100%;
  min-height: 240px;
  border: 1px solid rgba(148, 163, 184, 0.35);
  border-radius: 0.75rem;
  background: #0b1220; /* dark background to match viewer */
  color: #e5e7eb;
  padding: 0.9rem 1rem;
  font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
  font-size: 12.5px;
  line-height: 1.55;
}

/* Table for result preview */
.sql-table th, .sql-table td { border-color: rgba(148,163,184,0.35); }
.app-sidebar {
  width: var(--sidebar-width);
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 1.75rem;
  padding: 2rem 1rem;
  background: linear-gradient(180deg, var(--sidebar-gradient-start), var(--sidebar-gradient-end));
  color: #f8fafc;
  border-right: 1px solid rgba(255, 255, 255, 0.08);
  position: sticky;
  top: 0;
  height: 100vh;  /* fallback */
  height: 100svh; /* small viewport */
  height: 100dvh; /* dynamic viewport */
  z-index: 1200; /* ensure sidebar (and its dropdown) sits above overlay/content */
}
.app-sidebar__brand {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 0.5rem;
}
.app-sidebar__logo {
  display: grid;
  place-items: center;
  width: 2.8rem;
  height: 2.8rem;
  border-radius: 0.9rem;
  background: rgba(255, 255, 255, 0.15);
  font-weight: 700;
  font-size: 1.05rem;
  letter-spacing: 0.08em;
}
.app-sidebar__brand-text {
  font-size: 0.75rem;
  font-weight: 600;
  letter-spacing: 0.12em;
  text-transform: uppercase;
  color: rgba(255, 255, 255, 0.7);
}
.app-sidebar__nav {
  display: flex;
  flex-direction: column;
  align-items: stretch;
  gap: 0.75rem;
  width: 100%;
}
.app-sidebar__item {
  width: 3rem;
  height: 3rem;
  border-radius: 1.2rem;
  border: 1px solid rgba(255, 255, 255, 0.18);
  background: rgba(15, 23, 42, 0.18);
  color: rgba(255, 255, 255, 0.82);
  display: grid;
  place-items: center;
  transition: transform 0.2s, background 0.2s, color 0.2s, box-shadow 0.2s;
}
.app-sidebar__item:hover {
  transform: translateY(-2px);
  background: rgba(255, 255, 255, 0.28);
  box-shadow: 0 12px 24px -18px rgba(15, 23, 42, 0.6);
}
.app-sidebar__item.is-active {
  background: rgba(255, 255, 255, 0.95);
  color: var(--brand-700);
  box-shadow: 0 16px 30px -20px rgba(15, 23, 42, 0.65);
}

/* Inline, recursive sidebar tree (DB-backed) */
.app-sidebar__tree { list-style: none; margin: 0; padding: 0; display: flex; flex-direction: column; gap: 0.25rem; width: 100%; }
.app-sidebar__tree .app-sidebar__item-row { width: 100%; }
.app-sidebar__tree .app-sidebar__item {
  width: 100% !important; height: auto !important; border-radius: 0.6rem; border: 1px solid rgba(255,255,255,0.12);
  background: rgba(255,255,255,0.08); color: #fff; display: flex; align-items: center; justify-content: flex-start;
  padding: 0.45rem 0.6rem; gap: 0.55rem; text-align: left; box-shadow: none; transition: background 0.15s ease;
}
.app-sidebar__tree .app-sidebar__item:hover { background: rgba(255,255,255,0.16); transform: none; }
.app-sidebar__tree .app-sidebar__item.is-active { background: rgba(255,255,255,0.22); color: #fff; }
.app-sidebar__tree .truncate { white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.app-sidebar__tree.level-1 { padding-left: 0.5rem; }
.app-sidebar__tree.level-2 { padding-left: 1rem; }
.app-sidebar__tree.level-3 { padding-left: 1.5rem; }
.app-sidebar__profile {
  margin-top: auto;
  width: 100%;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 1rem;
}
.app-sidebar__profile-btn {
  width: 3rem;
  height: 3rem;
  border-radius: 9999px;
  background: rgba(255, 255, 255, 0.95);
  color: var(--brand-700);
  font-weight: 700;
  display: grid;
  place-items: center;
  border: none;
  box-shadow: 0 12px 20px -18px rgba(15, 23, 42, 0.6);
  transition: transform 0.2s, box-shadow 0.2s;
}
.app-sidebar__profile-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 20px 30px -18px rgba(15, 23, 42, 0.65);
}
.app-sidebar__dropdown {
  position: absolute;
  left: calc(var(--sidebar-width) - 1rem);
  top: 0;
  width: 15rem;
  background: rgba(255, 255, 255, 0.98);
  color: var(--text-primary);
  border-radius: 1.1rem;
  border: 1px solid rgba(148, 163, 184, 0.35);
  box-shadow: 0 25px 60px -25px rgba(15, 23, 42, 0.45);
  padding: 0.9rem;
  display: flex;
  flex-direction: column;
  gap: 0.35rem;
  backdrop-filter: blur(16px);
  z-index: 1000; /* above everything in the app shell */
}
.app-sidebar__dropdown button {
  border: none;
  background: transparent;
  text-align: left;
  font-size: 0.85rem;
  padding: 0.45rem 0.5rem;
  border-radius: 0.75rem;
  color: var(--text-primary);
  transition: background 0.2s;
}
.app-sidebar__dropdown button:hover {
  background: rgba(37, 99, 235, 0.08);
}
.app-sidebar__dropdown .danger {
  color: #dc2626;
}
@media (max-width: 900px) {
  .app-shell {
    flex-direction: column;
  }
  .app-sidebar {
    position: relative;
    height: auto;
    width: 100%;
    border-right: none;
    border-bottom: 1px solid rgba(15, 23, 42, 0.08);
    flex-direction: row;
    justify-content: space-between;
    padding: 1.25rem 1.5rem;
  }
  .app-sidebar__nav {
    flex-direction: row;
    justify-content: center;
  }
  .app-sidebar__profile {
    flex-direction: row;
    align-items: center;
    gap: 0.75rem;
  }
  .app-shell__main {
    padding: 1.5rem 1.25rem 2.5rem;
  }
}
/* ---------- Login refresh ---------- */
.login-screen {
  min-height: 100vh;
  width: 100%;
  padding: clamp(2rem, 4vw, 4rem);
  display: flex;
  align-items: center;
  justify-content: center;
  background: var(--shell-background);
}
.login-screen__panel {
  width: min(960px, 100%);
  display: grid;
  gap: 2rem;
  padding: clamp(2rem, 3vw, 3rem);
  border-radius: 2rem;
  background: rgba(255, 255, 255, 0.9);
  box-shadow: var(--surface-shadow);
  border: 1px solid rgba(148, 163, 184, 0.2);
  backdrop-filter: blur(12px);
}
@media (min-width: 900px) {
  .login-screen__panel {
    grid-template-columns: 1fr minmax(320px, 360px);
    align-items: center;
  }
}
.login-panel__header {
  display: flex;
  flex-direction: column;
  gap: 1.5rem;
}
.login-panel__logo {
  width: 3rem;
  height: 3rem;
  border-radius: 1rem;
  background: rgba(37, 99, 235, 0.15);
  color: var(--brand-700);
  display: grid;
  place-items: center;
  font-weight: 700;
  letter-spacing: 0.08em;
}
.login-panel__titles {
  display: flex;
  flex-direction: column;
  gap: 0.75rem;
}
.login-panel__eyebrow {
  font-size: 0.85rem;
  text-transform: uppercase;
  letter-spacing: 0.12em;
  color: var(--text-muted);
}
.login-panel__title {
  font-size: clamp(1.5rem, 1.4vw + 1.2rem, 2.4rem);
  font-weight: 700;
  line-height: 1.2;
}
.login-panel__subtitle {
  font-size: 1rem;
  color: var(--text-muted);
  max-width: 28rem;
}
.login-form {
  display: flex;
  flex-direction: column;
  gap: 0.75rem;
  background: rgba(248, 250, 252, 0.9);
  padding: clamp(1.75rem, 2.5vw, 2.5rem);
  border-radius: 1.5rem;
  border: 1px solid rgba(148, 163, 184, 0.35);
  box-shadow: 0 18px 36px -24px rgba(15, 23, 42, 0.5);
}
.login-form__title {
  font-size: 1.2rem;
  font-weight: 600;
  margin-bottom: 0.25rem;
}
.login-form__label {
  font-size: 0.85rem;
  font-weight: 500;
  color: var(--text-muted);
}
.login-form__input {
  border-radius: 1rem;
  border: 1px solid rgba(148, 163, 184, 0.45);
  padding: 0.65rem 1rem;
  font-size: 0.95rem;
  transition: border-color 0.2s, box-shadow 0.2s;
  background: white;
}
.login-form__input:focus {
  outline: none;
  border-color: rgba(37, 99, 235, 0.55);
  box-shadow: 0 0 0 4px rgba(37, 99, 235, 0.2);
}
.login-form__error {
  background: rgba(248, 113, 113, 0.1);
  color: #b91c1c;
  border: 1px solid rgba(248, 113, 113, 0.4);
  padding: 0.6rem 0.85rem;
  border-radius: 0.9rem;
  font-size: 0.85rem;
}
.login-form__submit {
  margin-top: 0.5rem;
  border-radius: 9999px;
  background: var(--brand-600);
  color: white;
  font-weight: 600;
  padding: 0.75rem 1rem;
  transition: transform 0.2s, background 0.2s;
  border: none;
}
.login-form__submit:hover:not(:disabled) {
  background: var(--brand-700);
  transform: translateY(-1px);
}
.login-form__submit:disabled {
  opacity: 0.6;
  cursor: not-allowed;
}
.login-panel__footer {
  display: flex;
  gap: 0.5rem;
  font-size: 0.85rem;
  color: var(--text-muted);
}
.login-panel__link {
  color: var(--brand-700);
  font-weight: 600;
}
.login-panel__link:hover {
  text-decoration: underline;
}

/* ---------- Sidebar dropdown tweaks ---------- */
.app-sidebar__overlay {
  position: fixed;
  inset: 0;
  background: transparent;
  z-index: 900; /* under dropdown, over main */
}
.app-sidebar__dropdown {
  left: calc(100% + 1.25rem);
  top: 50%;
  transform: translateY(-50%);
  width: 15rem;
  z-index: 1000;
}
@media (max-width: 900px) {
  .app-sidebar__dropdown {
    position: absolute;
    left: 50%;
    top: calc(100% + 0.75rem);
    transform: translateX(-50%);
  }
  .app-sidebar {
    z-index: 1200; /* keep above overlay on mobile layout too */
  }
}
/* ---------- Sidebar cascade flyout ---------- */
.app-sidebar__flyout {
  position: fixed;
  top: 0;
  bottom: 0;
  left: var(--sidebar-width); /* matches sidebar width */
  width: 18rem; /* ~w-72 */
  background: #fff;
  border-right: 1px solid rgba(15, 23, 42, 0.08);
  box-shadow: 0 10px 30px -10px rgba(15, 23, 42, 0.25);
  z-index: 1300; /* above sidebar (1200) and overlays */
}
.app-sidebar__flyout-overlay {
  position: fixed;
  inset: 0;
  background: transparent;
  z-index: 1250; /* below flyout, above content */
}
/* ---------- Conversation list refresh ---------- */
.chip {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  padding: 0.35rem 0.9rem;
  border-radius: 9999px;
  border: 1px solid rgba(148, 163, 184, 0.35);
  background: rgba(255, 255, 255, 0.9);
  font-size: 0.8rem;
  font-weight: 600;
  color: var(--text-muted);
  transition: background 0.2s, color 0.2s, border-color 0.2s, transform 0.2s;
}
.chip:hover {
  transform: translateY(-1px);
  border-color: rgba(37, 99, 235, 0.4);
}
.chip--active {
  background: var(--brand-600);
  color: white;
  border-color: transparent;
  box-shadow: 0 8px 18px -16px rgba(37, 99, 235, 0.8);
}
.chip--outline {
  background: transparent;
  border-color: rgba(148, 163, 184, 0.4);
  color: var(--text-primary);
}
.chip--outline:hover {
  border-color: rgba(37, 99, 235, 0.45);
  color: var(--brand-700);
}

.conversation-list {
  display: flex;
  flex-direction: column;
  gap: 1rem;
  height: 100%;
}
.conversation-list__toolbar {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0 1.25rem 0.5rem;
}
.conversation-list__tabs {
  display: inline-flex;
  gap: 0.75rem;
}
.conversation-list__count {
  font-size: 0.8rem;
  color: var(--text-muted);
}
.conversation-list__body {
  flex: 1;
  min-height: 0;
  display: flex;
  flex-direction: column;
  gap: 0.75rem;
  padding: 0 1.25rem 1.25rem;
}
.conversation-list__empty {
  margin-top: 1rem;
  color: var(--text-muted);
  font-size: 0.9rem;
}
.conversation-card {
  background: rgba(255, 255, 255, 0.92);
  border: 1px solid rgba(148, 163, 184, 0.28);
  border-radius: 1.25rem;
  padding: 1rem;
  display: flex;
  flex-direction: column;
  gap: 0.6rem;
  box-shadow: 0 12px 24px -20px rgba(15, 23, 42, 0.6);
  cursor: pointer;
  transition: transform 0.2s, border-color 0.2s, box-shadow 0.2s, background 0.2s;
}
.conversation-card:hover {
  transform: translateY(-2px);
  border-color: rgba(37, 99, 235, 0.35);
  box-shadow: 0 18px 36px -24px rgba(15, 23, 42, 0.6);
}
.conversation-card.is-selected {
  border-color: var(--brand-600);
  box-shadow: 0 20px 45px -24px rgba(37, 99, 235, 0.45);
}
.conversation-card.is-highlighted {
  border-color: rgba(34, 197, 94, 0.5);
  box-shadow: 0 18px 35px -22px rgba(34, 197, 94, 0.45);
}
.conversation-card.is-fresh {
  border-color: rgba(59, 130, 246, 0.45);
}
.conversation-card__top {
  display: flex;
  align-items: flex-start;
  justify-content: space-between;
  gap: 0.75rem;
}
.conversation-card__identity {
  display: flex;
  gap: 0.75rem;
}
.conversation-card__name {
  font-weight: 600;
  font-size: 0.95rem;
}
.conversation-card__meta {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  font-size: 0.75rem;
  color: var(--text-muted);
}
.badge {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  padding: 0.1rem 0.45rem;
  border-radius: 9999px;
  font-size: 0.65rem;
  font-weight: 600;
}
.badge--muted {
  background: rgba(148, 163, 184, 0.2);
  color: var(--text-muted);
}
.conversation-card__flag {
  display: flex;
  align-items: center;
  gap: 0.35rem;
  font-size: 0.8rem;
  color: var(--text-muted);
}
.conversation-card__snippet {
  font-size: 0.85rem;
  color: var(--text-primary);
}
.conversation-card__context {
  font-size: 0.75rem;
  color: var(--text-muted);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}
.conversation-card__actions {
  display: flex;
  justify-content: flex-end;
}
.status-dot {
  width: 0.65rem;
  height: 0.65rem;
  border-radius: 9999px;
  background: rgba(148, 163, 184, 0.45);
  margin-top: 0.35rem;
}
.status-dot.is-online {
  background: #22c55e;
  box-shadow: 0 0 0 4px rgba(34, 197, 94, 0.15);
}
/* ---------- Chat window refresh ---------- */
.chat-window {
  display: flex;
  flex-direction: column;
  min-height: 0;
  height: 100%;
  gap: 1rem;
}
.chat-window__header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 1.5rem;
  padding: 0 0 0.5rem;
  border-bottom: 1px solid rgba(148, 163, 184, 0.25);
}
.chat-window__title {
  font-size: 1rem;
  font-weight: 600;
}
.chat-window__subtitle {
  font-size: 0.8rem;
  color: var(--text-muted);
}
.chat-window__toolbar {
  display: flex;
  gap: 0.5rem;
  align-items: center;
}
.chat-window__pill {
  padding: 0.25rem 0.75rem;
  border-radius: 9999px;
  background: rgba(15, 23, 42, 0.06);
  font-size: 0.75rem;
  color: var(--text-muted);
}
.chat-window__draft {
  background: rgba(253, 230, 138, 0.25);
  border: 1px solid rgba(250, 204, 21, 0.35);
  border-radius: 1.25rem;
  padding: 1rem 1.2rem;
  display: flex;
  flex-direction: column;
  gap: 0.75rem;
}
.chat-window__draft-head {
  display: flex;
  flex-direction: column;
  gap: 0.15rem;
}
.chat-window__draft-title {
  font-size: 0.85rem;
  font-weight: 600;
  color: #b45309;
}
.chat-window__draft-hint {
  font-size: 0.75rem;
  color: var(--text-muted);
}
.chat-window__draft-content {
  max-height: 14rem;
  overflow: auto;
  background: rgba(255, 255, 255, 0.9);
  border-radius: 1rem;
  padding: 0.75rem;
  border: 1px solid rgba(148, 163, 184, 0.25);
}
.chat-window__draft-actions {
  display: flex;
  flex-wrap: wrap;
  gap: 0.5rem;
}
.chat-window__messages {
  flex: 1;
  min-height: 0;
  display: flex;
  flex-direction: column;
  gap: 0.75rem;
  padding: 0 0 0.5rem;
}
.chat-row {
  display: flex;
  align-items: flex-end;
  gap: 0.5rem;
}
.chat-bubble {
  max-width: min(60ch, 100%);
  border-radius: 1.25rem;
  padding: 0.75rem 1rem;
  font-size: 0.9rem;
  line-height: 1.45;
  box-shadow: 0 12px 28px -24px rgba(15, 23, 42, 0.5);
}
.chat-bubble.agent {
  background: var(--bubble-agent-bg);
  color: var(--text-primary);
  border: 1px solid rgba(148, 163, 184, 0.25);
}
.chat-bubble.visitor {
  background: var(--bubble-visitor-bg);
  color: var(--bubble-visitor-text);
  border: 1px solid rgba(148, 163, 184, 0.2);
}
.msg-ts {
  font-size: 0.7rem;
  color: var(--text-muted);
  margin-top: 0.25rem;
}
.chat-window__composer {
  display: flex;
  flex-direction: column;
  gap: 0.75rem;
  border-top: 1px solid rgba(148, 163, 184, 0.25);
  padding-top: 0.75rem;
}
.chat-window__send {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  padding: 0.65rem 1.5rem;
  border-radius: 9999px;
  background: var(--brand2-600);
  color: white;
  font-weight: 600;
  transition: background 0.2s, transform 0.2s;
  border: none;
}
.chat-window__send:hover:not(:disabled) {
  background: var(--brand2-700);
  transform: translateY(-1px);
}
.chat-window__send:disabled {
  opacity: 0.6;
  cursor: not-allowed;
}
/* ---------- Visitor details refresh ---------- */
.visitor-details {
  display: flex;
  flex-direction: column;
  gap: 1rem;
  padding-right: 0.5rem;
}
.visitor-details__card {
  background: rgba(255, 255, 255, 0.92);
  border: 1px solid rgba(148, 163, 184, 0.28);
  border-radius: 1.25rem;
  padding: 1.1rem 1.25rem;
  box-shadow: 0 14px 32px -24px rgba(15, 23, 42, 0.5);
}
.visitor-details__card + .visitor-details__card {
  margin-top: 0;
}
.visitor-details__card h3 {
  font-size: 0.9rem;
  font-weight: 600;
  margin-bottom: 0.6rem;
}
.visitor-details__card table {
  width: 100%;
  border-collapse: collapse;
  font-size: 0.8rem;
}
.visitor-details__card table td {
  padding: 0.35rem 0;
  vertical-align: top;
}
.visitor-details__card table td:first-child {
  width: 35%;
  color: var(--text-muted);
  font-weight: 500;
}
.visitor-details__card table a {
  color: var(--brand-700);
  font-weight: 500;
}
.visitor-details .inline-flex {
  background: rgba(148, 163, 184, 0.16);
  border-color: transparent;
  color: var(--text-muted);
}
/* ---------- Visitors page refresh ---------- */
.visitors-page {
  display: flex;
  flex-direction: column;
  height: 100%;
  gap: 1rem;
}
.visitors-page__header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0 0 0.5rem;
  border-bottom: 1px solid rgba(148, 163, 184, 0.25);
}
.visitors-page__search {
  padding: 0.5rem 0;
  border-bottom: 1px solid rgba(148, 163, 184, 0.2);
}
.visitors-page__input {
  width: 100%;
  border-radius: 1rem;
  border: 1px solid rgba(148, 163, 184, 0.35);
  padding: 0.6rem 1rem;
  font-size: 0.9rem;
  transition: border-color 0.2s, box-shadow 0.2s;
}
.visitors-page__input:focus {
  outline: none;
  border-color: rgba(37, 99, 235, 0.55);
  box-shadow: 0 0 0 4px rgba(37, 99, 235, 0.2);
}
.visitors-page__table {
  flex: 1;
  min-height: 0;
}
.visitors-table {
  width: 100%;
  border-collapse: collapse;
  font-size: 0.85rem;
}
.visitors-table__head {
  position: sticky;
  top: 0;
  background: rgba(248, 250, 252, 0.95);
  backdrop-filter: blur(8px);
  text-transform: uppercase;
  letter-spacing: 0.05em;
  font-size: 0.7rem;
  color: var(--text-muted);
}
.visitors-table__heading,
.visitors-table__cell {
  padding: 0.75rem 1rem;
  text-align: left;
  border-bottom: 1px solid rgba(148, 163, 184, 0.15);
}
.visitors-table__heading--right,
.visitors-table__cell--right {
  text-align: right;
}
.visitors-table__cell--wide {
  max-width: 320px;
}
.visitors-table__row {
  transition: background 0.2s, transform 0.2s;
}
.visitors-table__row:hover {
  background: rgba(226, 232, 240, 0.35);
  transform: translateY(-1px);
}
.visitors-table__avatar {
  position: relative;
  display: flex;
  align-items: center;
  justify-content: center;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 9999px;
  background: rgba(148, 163, 184, 0.25);
  color: var(--text-muted);
  font-weight: 600;
}
.visitors-table__avatar span {
  position: absolute;
  bottom: -0.2rem;
  right: -0.2rem;
  width: 0.65rem;
  height: 0.65rem;
  border-radius: 9999px;
  background: #22c55e;
  box-shadow: 0 0 0 4px rgba(255, 255, 255, 0.8);
}
.visitors-table__cell .relative {
  position: relative;
  display: flex;
  align-items: center;
  justify-content: center;
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 9999px;
  background: rgba(148, 163, 184, 0.25);
  color: var(--text-muted);
  font-weight: 600;
}
.visitors-table__cell .relative > div {
  all: unset;
}
.visitors-table__cell .relative > span {
  position: absolute;
  width: 0.65rem;
  height: 0.65rem;
  border-radius: 9999px;
  background: #22c55e;
  bottom: -0.15rem;
  right: -0.15rem;
  box-shadow: 0 0 0 4px rgba(255, 255, 255, 0.85);
}
/* ---------- Module surfaces defaults ---------- */
.panel h1,
.panel h2,
.panel h3 {
  font-weight: 600;
  color: var(--text-primary);
}
.panel table {
  width: 100%;
  border-collapse: collapse;
  font-size: 0.85rem;
}
.panel table th,
.panel table td {
  padding: 0.75rem 1rem;
  border-bottom: 1px solid rgba(148, 163, 184, 0.18);
}
.panel table tbody tr:hover {
  background: rgba(226, 232, 240, 0.35);
}
.panel button,
.panel .btn {
  border-radius: 0.9rem;
  border: 1px solid rgba(148, 163, 184, 0.35);
  background: white;
  color: var(--text-primary);
  padding: 0.45rem 0.9rem;
  font-size: 0.85rem;
  font-weight: 500;
  transition: background 0.2s, transform 0.2s, border-color 0.2s;
}
.panel button:hover,
.panel .btn:hover {
  transform: translateY(-1px);
  border-color: rgba(37, 99, 235, 0.4);
  background: rgba(237, 242, 255, 0.65);
}
.panel .btn-primary,
.panel button.bg-indigo-600 {
  background: var(--brand-600);
  color: white;
  border-color: transparent;
}
.panel .btn-primary:hover,
.panel button.bg-indigo-600:hover {
  background: var(--brand-700);
}
.panel input,
.panel select,
.panel textarea {
  border-radius: 0.85rem;
  border: 1px solid rgba(148, 163, 184, 0.35);
  padding: 0.5rem 0.75rem;
}
.panel input:focus,
.panel select:focus,
.panel textarea:focus {
  outline: none;
  border-color: rgba(37, 99, 235, 0.5);
  box-shadow: 0 0 0 4px rgba(37, 99, 235, 0.18);
}
