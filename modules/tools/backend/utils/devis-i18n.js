const DEFAULT_ISO = 'fr';

const LOCALE_BY_ISO = {
  fr: 'fr-FR',
  en: 'en-GB',
  nl: 'nl-NL',
  de: 'de-DE',
  cs: 'cs-CZ',
  it: 'it-IT',
  es: 'es-ES',
  pt: 'pt-PT',
  pl: 'pl-PL',
  lt: 'lt-LT',
};

const LABELS = {
  fr: {
    doc_title: 'Devis',
    quote_number: 'Numéro de devis',
    date: 'Date',
    subtotal_products: 'Sous-total produits',
    discount: 'Remise',
    email_intro_html: '',
    client_info: 'Informations sur le client',
    vendor_info: 'Informations sur le vendeur',
    client_name: 'Nom du client',
    client_company: 'Société du client',
    client_email: 'Email du client',
    vendor_company: 'Nom de la société du vendeur',
    vendor_contact: 'Nom du contact du vendeur',
    vendor_email: 'Email du vendeur',
    vendor_phone: 'Téléphone du magasin',
    details: 'Détails',
    reference: 'Référence',
    product_name: 'Nom du produit',
    description: 'Description',
    unit_price: 'Prix unitaire',
    quantity: 'Quantité',
    total: 'Total',
    product_link: 'Lien du produit',
    image: 'Image',
    link_text: 'Lien',
    transport_cost: 'Coût du transport',
    delivery_lead_time: 'Délai de livraison',
    summary: 'Résumé',
    remarques_text: 'Remarques',
  },
  en: {
    doc_title: 'Quote',
    quote_number: 'Quote number',
    date: 'Date',
    subtotal_products: 'Products subtotal',
    discount: 'Discount',
    email_intro_html: '',
    client_info: 'Customer information',
    vendor_info: 'Vendor information',
    client_name: 'Customer name',
    client_company: 'Customer company',
    client_email: 'Customer email',
    vendor_company: 'Vendor company',
    vendor_contact: 'Vendor contact',
    vendor_email: 'Vendor email',
    vendor_phone: 'Shop phone',
    details: 'Details',
    reference: 'Reference',
    product_name: 'Product name',
    description: 'Description',
    unit_price: 'Unit price',
    quantity: 'Qty',
    total: 'Total',
    product_link: 'Product link',
    image: 'Image',
    link_text: 'Link',
    transport_cost: 'Transport cost',
    delivery_lead_time: 'Delivery time',
    summary: 'Summary',
    remarques_text: 'Remarks',
  },
  nl: {
    doc_title: 'Offerte',
    quote_number: 'Offertenummer',
    date: 'Datum',
    subtotal_products: 'Subtotaal producten',
    discount: 'Korting',
    email_intro_html: '',
    client_info: 'Klantgegevens',
    vendor_info: 'Verkopergegevens',
    client_name: 'Naam klant',
    client_company: 'Bedrijf klant',
    client_email: 'E-mail klant',
    vendor_company: 'Bedrijf verkoper',
    vendor_contact: 'Contactpersoon verkoper',
    vendor_email: 'E-mail verkoper',
    vendor_phone: 'Telefoon winkel',
    details: 'Details',
    reference: 'Referentie',
    product_name: 'Productnaam',
    description: 'Beschrijving',
    unit_price: 'Stukprijs',
    quantity: 'Aantal',
    total: 'Totaal',
    product_link: 'Productlink',
    image: 'Afbeelding',
    link_text: 'Link',
    transport_cost: 'Transportkosten',
    delivery_lead_time: 'Levertijd',
    summary: 'Samenvatting',
    remarques_text: 'Opmerkingen',
  },
  de: {
    doc_title: 'Angebot',
    quote_number: 'Angebotsnummer',
    date: 'Datum',
    subtotal_products: 'Zwischensumme Produkte',
    discount: 'Rabatt',
    email_intro_html: '',
    client_info: 'Kundendaten',
    vendor_info: 'Verkäuferdaten',
    client_name: 'Kundenname',
    client_company: 'Kundenfirma',
    client_email: 'Kunden-E-Mail',
    vendor_company: 'Firma des Verkäufers',
    vendor_contact: 'Kontakt des Verkäufers',
    vendor_email: 'E-Mail des Verkäufers',
    vendor_phone: 'Telefon des Shops',
    details: 'Details',
    reference: 'Referenz',
    product_name: 'Produktname',
    description: 'Beschreibung',
    unit_price: 'Stückpreis',
    quantity: 'Menge',
    total: 'Gesamt',
    product_link: 'Produktlink',
    image: 'Bild',
    link_text: 'Link',
    transport_cost: 'Transport',
    delivery_lead_time: 'Lieferzeit',
    summary: 'Zusammenfassung',
    remarques_text: 'Bemerkungen',
  },
  cs: {
    doc_title: 'Cenová nabídka',
    quote_number: 'Číslo nabídky',
    date: 'Datum',
    subtotal_products: 'Mezisoučet produktů',
    discount: 'Sleva',
    email_intro_html: '',
    client_info: 'Informace o zákazníkovi',
    vendor_info: 'Informace o prodejci',
    client_name: 'Jméno zákazníka',
    client_company: 'Společnost zákazníka',
    client_email: 'E-mail zákazníka',
    vendor_company: 'Společnost prodejce',
    vendor_contact: 'Kontakt prodejce',
    vendor_email: 'E-mail prodejce',
    vendor_phone: 'Telefon obchodu',
    details: 'Detaily',
    reference: 'Reference',
    product_name: 'Název produktu',
    description: 'Popis',
    unit_price: 'Jednotková cena',
    quantity: 'Množství',
    total: 'Celkem',
    product_link: 'Odkaz na produkt',
    image: 'Obrázek',
    link_text: 'Odkaz',
    transport_cost: 'Doprava',
    delivery_lead_time: 'Doba dodání',
    summary: 'Souhrn',
    remarques_text: 'Poznámky',
  },
  it: {
    doc_title: 'Preventivo',
    quote_number: 'Numero preventivo',
    date: 'Data',
    subtotal_products: 'Subtotale prodotti',
    discount: 'Sconto',
    email_intro_html: '',
    client_info: 'Dati cliente',
    vendor_info: 'Dati venditore',
    client_name: 'Nome cliente',
    client_company: 'Azienda cliente',
    client_email: 'Email cliente',
    vendor_company: 'Azienda venditore',
    vendor_contact: 'Contatto venditore',
    vendor_email: 'Email venditore',
    vendor_phone: 'Telefono negozio',
    details: 'Dettagli',
    reference: 'Riferimento',
    product_name: 'Nome prodotto',
    description: 'Descrizione',
    unit_price: 'Prezzo unitario',
    quantity: 'Quantità',
    total: 'Totale',
    product_link: 'Link prodotto',
    image: 'Immagine',
    link_text: 'Link',
    transport_cost: 'Trasporto',
    delivery_lead_time: 'Tempi di consegna',
    summary: 'Riepilogo',
    remarques_text: 'Note',
  },
  es: {
    doc_title: 'Presupuesto',
    quote_number: 'Número de presupuesto',
    date: 'Fecha',
    subtotal_products: 'Subtotal de productos',
    discount: 'Descuento',
    email_intro_html: '',
    client_info: 'Información del cliente',
    vendor_info: 'Información del vendedor',
    client_name: 'Nombre del cliente',
    client_company: 'Empresa del cliente',
    client_email: 'Email del cliente',
    vendor_company: 'Empresa del vendedor',
    vendor_contact: 'Contacto del vendedor',
    vendor_email: 'Email del vendedor',
    vendor_phone: 'Teléfono de la tienda',
    details: 'Detalles',
    reference: 'Referencia',
    product_name: 'Nombre del producto',
    description: 'Descripción',
    unit_price: 'Precio unitario',
    quantity: 'Cantidad',
    total: 'Total',
    product_link: 'Enlace del producto',
    image: 'Imagen',
    link_text: 'Enlace',
    transport_cost: 'Transporte',
    delivery_lead_time: 'Plazo de entrega',
    summary: 'Resumen',
    remarques_text: 'Observaciones',
  },
  pt: {
    doc_title: 'Orçamento',
    quote_number: 'Número do orçamento',
    date: 'Data',
    subtotal_products: 'Subtotal de produtos',
    discount: 'Desconto',
    email_intro_html: '',
    client_info: 'Informações do cliente',
    vendor_info: 'Informações do vendedor',
    client_name: 'Nome do cliente',
    client_company: 'Empresa do cliente',
    client_email: 'Email do cliente',
    vendor_company: 'Empresa do vendedor',
    vendor_contact: 'Contato do vendedor',
    vendor_email: 'Email do vendedor',
    vendor_phone: 'Telefone da loja',
    details: 'Detalhes',
    reference: 'Referência',
    product_name: 'Nome do produto',
    description: 'Descrição',
    unit_price: 'Preço unitário',
    quantity: 'Quantidade',
    total: 'Total',
    product_link: 'Link do produto',
    image: 'Imagem',
    link_text: 'Link',
    transport_cost: 'Transporte',
    delivery_lead_time: 'Prazo de entrega',
    summary: 'Resumo',
    remarques_text: 'Observações',
  },
};

function normalizeIso(isoCode) {
  const raw = String(isoCode || '').trim().toLowerCase();
  if (!raw) return DEFAULT_ISO;
  if (raw.length === 2) return raw;
  if (raw.includes('-')) return raw.split('-')[0];
  return raw.slice(0, 2);
}

export function getDevisI18n({ isoCode, locale, labelsOverride } = {}) {
  const iso = normalizeIso(isoCode);
  const resolvedLocale = String(locale || '').trim() || LOCALE_BY_ISO[iso] || LOCALE_BY_ISO[DEFAULT_ISO];
  const baseLabels = LABELS[iso] || LABELS[DEFAULT_ISO];
  const safeOverride = labelsOverride && typeof labelsOverride === 'object' && !Array.isArray(labelsOverride) ? labelsOverride : null;
  const labels = safeOverride ? { ...baseLabels, ...safeOverride } : baseLabels;
  return {
    iso,
    locale: resolvedLocale,
    labels,
    t: (key, fallback = '') => labels[key] || LABELS[DEFAULT_ISO][key] || fallback || key,
  };
}
